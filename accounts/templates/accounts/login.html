{% extends "base.html" %}
{% load socialaccount %}

{% block content %}
<h2>Login</h2>

<form id="login-form">
    {% csrf_token %}
    <input type="text" name="username" placeholder="Username"><br>
    <input type="password" name="password" placeholder="Password"><br>
    <button type="submit">Login</button>
</form>

<p>Donâ€™t have an account? <a href="{% url 'register' %}">Register</a></p>

<a href="{% provider_login_url 'google' %}">Login with Google</a>

<script>
const loginForm = document.getElementById('login-form');

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(loginForm);
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    try {
        const response = await fetch("{% url 'login' %}", {
            method: "POST",
            headers: { "X-CSRFToken": csrftoken },
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            localStorage.setItem('access_token', data.access_token);
            localStorage.setItem('username', data.username);
            window.location.href = "/home/";
        } else {
            alert(data.error);
        }
    } catch (err) {
        console.error("Error during login:", err);
    }
});
</script>
{% endblock %}
